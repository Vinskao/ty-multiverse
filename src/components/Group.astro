---

---

<div id="group-container"></div>

<style>
  #group-container {
    margin: 5%;
    padding: 0;
    max-width: 100%;
  }

  .army-container {
    margin: 20px 0;
    padding: 15px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .army-title {
    font-size: 24px;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
  }

  .character-info {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.9);
    padding: 20px;
    border-radius: 15px;
    color: white;
    z-index: 1000;
    max-width: 80%;
    max-height: 80vh;
    overflow-y: auto;
    border: 2px solid rgba(255, 255, 255, 0.3);
  }

  .character-info.show {
    display: block;
  }

  .character-info img {
    width: 300px;
    height: auto;
    float: right;
    margin-left: 20px;
    border-radius: 8px;
  }

  .character-info p {
    margin: 5px 0;
    font-size: 16px;
  }

  .character-info .name {
    font-size: 32px;
    font-weight: bold;
    margin-bottom: 15px;
    color: #ffd700;
  }

  .character-info .army {
    font-size: 20px;
    color: #ffa500;
    margin-bottom: 10px;
  }

  .close-button {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    padding: 5px 10px;
  }

  .close-button:hover {
    color: #ffd700;
  }
</style>

<script>
  if (!import.meta.env.PUBLIC_TYMB_URL) {
  throw new Error('PUBLIC_TYMB_URL ç’°å¢ƒè®Šé‡æœªè¨­ç½®');
}
if (!import.meta.env.PUBLIC_PEOPLE_IMAGE_URL) {
  throw new Error('PUBLIC_PEOPLE_IMAGE_URL ç’°å¢ƒè®Šé‡æœªè¨­ç½®');
}

const TYMB_URL = import.meta.env.PUBLIC_TYMB_URL;
const PEOPLE_IMAGE_URL = import.meta.env.PUBLIC_PEOPLE_IMAGE_URL;
  
  // å®šç¾©è»éšŠé¡è‰²æ˜ å°„
  const ARMY_COLORS = {
    "å…«é£Ÿ": "#46A3FF",      
    "åˆæ¡‘": "#FFA500",      
    "Buse": "#AD5A5A",      
    "PhÃ©nix": "#FFFF00",    
    "å§¦é–¥": "#808080",      
    "å§¦å›š": "#FFC0CB",      
    "Regalos": "#00FF00",   
    "å¤©éš›å¥³å­©": "#00BFFF",  
    "å¤–ç•Œ": "#000080",      
    "ç‹": "#FF0000",        
    "Intouchable": "#8B4513",
    "å¡µæ°‘": "#008080",      
    "ç„æ—": "#800080",      
    "Default": "#FFFFFF"    
  };

  // å‰µå»ºè§’è‰²å¡ç‰‡
  function createCharacterCard(character) {
    const characterContainer = document.createElement('div');
    characterContainer.style.cssText = 'display:inline-block;width:200px;height:300px;text-align:center;margin-left:-100px;position:relative;z-index:1;';

    const img = document.createElement('img');
    img.style.cssText = 'width:200px;height:300px;display:block;object-fit:contain;margin:0 auto;padding:0;border:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:2;';
    img.src = `${PEOPLE_IMAGE_URL}/${character.name || 'default'}.png`;
    img.alt = character.nameOriginal;
    img.onerror = function() {
      this.src = `${PEOPLE_IMAGE_URL}/default.png`;
    };
    img.addEventListener('mouseover', () => {
      img.style.zIndex = '3';
      showCharacterInfo(character);
    });
    img.addEventListener('mouseout', () => {
      img.style.zIndex = '2';
    });

    const infoContainer = document.createElement('div');
    infoContainer.style.cssText = 'padding:2px;color:#fff;text-shadow:0 0 2px rgba(0,0,0,0.5);width:200px;position:absolute;bottom:-40px;left:0;overflow:hidden;font-size:12px;z-index:4;background-color:transparent;padding:5px;border-radius:5px;';

    const nameText = document.createElement('p');
    nameText.textContent = character.nameOriginal;
    nameText.style.cssText = 'margin:0;font-weight:bold;font-size:clamp(8px,1.2vw,10px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;';

    const attributesText = document.createElement('p');
    attributesText.textContent = `Attributes: ${character.attributes}`;
    attributesText.style.cssText = 'margin:0;font-size:clamp(6px,0.8vw,8px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;';

    const sizeText = document.createElement('p');
    sizeText.textContent = `${character.heightCm}cm / ${character.weightKg}kg`;
    sizeText.style.cssText = 'margin:0;font-size:clamp(6px,0.8vw,8px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;';

    infoContainer.appendChild(nameText);
    infoContainer.appendChild(attributesText);
    infoContainer.appendChild(sizeText);
    characterContainer.appendChild(img);
    characterContainer.appendChild(infoContainer);
    return characterContainer;
  }

  // å‰µå»ºè»éšŠå®¹å™¨
  function createArmyContainer(army, characters) {
    const armyContainer = document.createElement('div');
    armyContainer.className = 'army-container';
    armyContainer.style.marginTop = '50px';

    const armyTitle = document.createElement('h2');
    armyTitle.className = 'army-title';
    armyTitle.textContent = army;
    armyTitle.style.marginBottom = '15px';

    const charactersGrid = document.createElement('div');
    charactersGrid.className = 'box-container';
    charactersGrid.style.margin = '0 auto';

    characters.forEach(character => {
      charactersGrid.appendChild(createCharacterCard(character));
    });

    armyContainer.appendChild(armyTitle);
    armyContainer.appendChild(charactersGrid);
    return armyContainer;
  }

  // é¡¯ç¤ºè§’è‰²è©³ç´°è³‡è¨Š
  function showCharacterInfo(character) {
    let infoContainer = document.querySelector('.character-info');
    if (!infoContainer) {
      infoContainer = document.createElement('div');
      infoContainer.className = 'character-info';
      const groupContainer = document.getElementById('group-container');
      if (groupContainer) {
        groupContainer.appendChild(infoContainer);
      }
    }

    const infoContent = document.createElement('div');
    infoContent.className = 'info-content';
    infoContent.innerHTML = `
      <button class="close-button">&times;</button>
      <p class="name">${character.nameOriginal}</p>
      <p class="army">Army: ${character.originArmyName} => ${character.armyName}</p>
      <p>Physic Power: ${character.physicPower}</p>
      <p>Magic Power: ${character.magicPower}</p>
      <p>Utility Power: ${character.utilityPower}</p>
      <p>Attributes: ${character.attributes}</p>
      <p>Ass Size: ${character.assSize}</p>
      <p>Boobs Size: ${character.boobsSize}</p>
      <p>${character.heightCm}(cm)</p>
      <p>${character.weightKg}(kg)</p>
      <p>${character.profession}</p>
      <p>Job: ${character.job}</p>
      <p>Combat: ${character.combat}</p>
      <p>Concubine: ${character.concubine}</p>
      <p>Dept: ${character.deptName}</p>
      <p>Faction: ${character.faction}</p>
      <p>Gave Birth: ${character.gaveBirth}</p>
    `;

    infoContainer.innerHTML = '';
    infoContainer.appendChild(infoContent);
    // ç§»é™¤ show é¡åˆ¥ï¼Œä¸å†é¡¯ç¤ºè§’è‰²è©³ç´°ä¿¡æ¯

    // ç§»é™¤é—œé–‰æŒ‰éˆ•å’Œé»æ“Šäº‹ä»¶ï¼Œå› ç‚ºä¸å†é¡¯ç¤ºè§’è‰²è©³ç´°ä¿¡æ¯
    // const closeButton = infoContainer.querySelector('.close-button');
    // if (closeButton) {
    //   closeButton.addEventListener('click', () => {
    //     infoContainer.classList.remove('show');
    //   });
    // }
    // document.addEventListener('click', function closeInfo(e) {
    //   if (!infoContainer.contains(e.target as Node)) {
    //     infoContainer.classList.remove('show');
    //     document.removeEventListener('click', closeInfo);
    //   }
    // });
  }

  // åˆå§‹åŒ–é é¢
  document.addEventListener("DOMContentLoaded", async function () {
    try {
      // ä½¿ç”¨å…±ç”¨çš„è§’è‰²æœå‹™
      const characterService = (await import('../services/characterService')).default.getInstance();
      const data = await characterService.getCharacters();
      
      const armyGroups = {};
      data.forEach(character => {
        const army = character.armyName || 'Unknown Army';
        if (!armyGroups[army]) {
          armyGroups[army] = [];
        }
        armyGroups[army].push(character);
      });

      const mainContainer = document.createElement('div');
      mainContainer.className = 'army-groups';

      Object.entries(armyGroups).forEach(([army, characters]) => {
        mainContainer.appendChild(createArmyContainer(army, characters));
      });

      const container = document.getElementById('group-container');
      if (container) {
        container.appendChild(mainContainer);
      }
    } catch (error) {
      console.error('âŒ Group çµ„ä»¶è¼‰å…¥å¤±æ•—:', error);

      // å‰µå»ºéŒ¯èª¤æç¤ºå€åŸŸ
      const errorContainer = document.createElement('div');
      errorContainer.style.cssText = `
        padding: 20px;
        margin: 20px 0;
        background: linear-gradient(135deg, rgba(255, 87, 87, 0.1), rgba(255, 87, 87, 0.05));
        border: 2px solid rgba(255, 87, 87, 0.3);
        border-radius: 12px;
        color: #ff5757;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        white-space: pre-wrap;
        text-shadow: 0 0 5px rgba(255, 87, 87, 0.3);
      `;

      const errorTitle = document.createElement('div');
      errorTitle.style.cssText = `
        font-weight: bold;
        font-size: 16px;
        margin-bottom: 10px;
        color: #ff3333;
      `;
      errorTitle.textContent = 'ğŸš¨ è¼‰å…¥å¤±æ•— - Group çµ„ä»¶';

      const errorMessage = document.createElement('div');
      errorMessage.textContent = `éŒ¯èª¤è©³æƒ…:\n${error.message || error}\n\nè«‹æª¢æŸ¥:\nâ€¢ å¾Œç«¯æœå‹™æ˜¯å¦æ­£å¸¸é‹è¡Œ\nâ€¢ éšŠåˆ—ç³»çµ±æ˜¯å¦å·²å•Ÿå‹•\nâ€¢ API ç«¯é»æ˜¯å¦æ­£ç¢º`;

      errorContainer.appendChild(errorTitle);
      errorContainer.appendChild(errorMessage);

      // æ’å…¥åˆ°é é¢é ‚éƒ¨
      const container = document.querySelector('#group-container') || document.body;
      container.insertBefore(errorContainer, container.firstChild);

      // åŒæ™‚é¡¯ç¤º alert æç¤ºç”¨æˆ¶
      alert(`Group çµ„ä»¶è¼‰å…¥å¤±æ•—:\n${error.message || error}\n\nè«‹æª¢æŸ¥å¾Œç«¯æœå‹™ç‹€æ…‹ã€‚`);
    }
  });
</script>
