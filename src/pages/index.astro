---
import { getCollection } from 'astro:content';

// Layout import — provides basic page elements: <head>, <nav>, <footer> etc.
import BaseLayout from '../layouts/BaseLayout.astro';

// Component Imports
import CallToAction from '../components/CallToAction.astro';
import Grid from '../components/Grid.astro';
import Hero from '../components/Hero.astro';
import Icon from '../components/Icon.astro';
import Pill from '../components/Pill.astro';
import PortfolioPreview from '../components/PortfolioPreview.astro';

// Page section components
import ContactCTA from '../components/ContactCTA.astro';
import Skills from '../components/Skills.astro';

// Content Fetching: List four most recent work projects
const projects = (await getCollection('work'))
	.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
	.slice(0, 4);

// 修改服務器啟動時間的處理
let serverStartTime = new Date().toISOString();
try {
    // 使用環境變量或默認值
    serverStartTime = import.meta.env.SERVER_START_TIME || serverStartTime;
} catch (error) {
    console.error('Error getting server start time:', error);
}

// 檢查是否需要顯示登入提示
const showLoginAlert = Astro.url.searchParams.get('showLoginAlert') === 'true';

// Full Astro Component Syntax:
// https://docs.astro.build/core-concepts/astro-components/
---
<meta charset="UTF-8" />
<head>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kalam&display=swap">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.15.1/devicon.min.css">
          
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js" async></script>
<style>
  .github-graph {
    width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
  }
  .icon-container div .tooltip {
	  opacity: 0; 
	  position: absolute;
	  background-color: rgba(75, 0, 130, 0.7);
	  color: white;
	  padding: 4px 8px;
	  border-radius: 10px;
	  font-size: 18px;
	  white-space: nowrap;
	  top: 5px;
	  left: 110%; 
	  transition: opacity 0.3s ease;
	  z-index: 999;
  }

  .horizontal-icons div:hover .tooltip {
	  opacity: 1;
  }
  
  .horizontal-icons {
	  display: flex;
	  position: relative;
	  background-image: url('/tymultiverse/assets/barchart-background.jpg');
	  background-position: bottom;
	  border-radius: 20px;
	  margin-top: 1px;
	  padding-right: 8px;
	  z-index: 998;
  }

  .horizontal-icons:hover {
	  transform: scale(1.2);
	  transition: transform 0.3s ease;
  }

  .icon-container {
	  position: relative; 
	  margin-left: 20px;
	  display: flex;
	  flex-direction: column;
	  justify-content: flex-start;
	  position: relative;
		  
  }

  .icon-container img {
	  width: 30px;
	  margin-left: 5px;
	  transition: transform 0.3s ease;
	  cursor: pointer;
	  
  }

  .icon-container img:hover {
	  transform: scale(1.5); 
  }

  .video-container {
	  position: relative; 
  }

  .text-overlay {
	  position: absolute; 
	  top: 33%; 
	  left: -10%; 
	  transform: translate(-135%, -42%); 
	  color: #fafafa;  
	  padding: 10px; 
	  z-index: 1; 
	  font-size: 20px;
	  width: 55%;
	  font-weight: bold;
	  font-family: 'Kalam', cursive;
	  opacity: 0; 
	  background: linear-gradient(
	  166deg, 
	  rgba(51, 2, 125, 0.65) 0%, 
	  rgba(128, 0, 128, 0.25) 15%, 
	  rgba(128, 0, 128, 0.55) 30%, 
	  rgba(128, 0, 128, 0.15) 45%, 
	  rgba(128, 0, 128, 0.65) 60%, 
	  rgba(128, 0, 128, 0.40) 75%, 
	  rgba(64, 9, 146, 0.9) 100%
	  );
	  background-size: cover; 
	  background-repeat: no-repeat; 
	  border-radius: 30px; 
	  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
		 animation: fadeIn 1s ease-in forwards;
	  backdrop-filter: blur(10px);
	  padding: 25px;
	  word-spacing: 10px;
	  box-shadow: 0 0 40px rgba(128, 0, 128, 0.5);
	  transition: top 0.5s ease, left 10s ease;
	  letter-spacing: 1.5px;
	  transform: scale(1); 
		 transition: transform 0.3s ease, top 0.5s ease, left 10s ease; 
	  
  }

  .text-overlay:hover {
	  transform: scale(1.2);
	  transition: transform 0.3s ease;
	  top: 33%; 
	  left: -10%; 
  }

  @keyframes fadeIn {
	  from {
		  opacity: 0; 
	  }
	  to {
		  opacity: 1; 
	  }
  }

  .hero {
	  display: flex;
	  flex-direction: column;
	  align-items: center;
	  gap: 2rem;
  }

  .roles {
	  display: none;
  }

  .hero img {
	  object-fit: cover;
	  object-position: top;
	  border-radius: 1rem;
	  box-shadow: var(--shadow-md);
  }

  @media (min-width: 50em) {
	  .hero {
		  display: grid;
		  grid-template-columns: 6fr 4fr;
		  padding-inline: 2.5rem;
		  gap: 3.75rem;
	  }

	  .roles {
		  margin-top: 0.5rem;
		  display: flex;
		  gap: 0.5rem;
	  }

	  .hero img {
		  border-radius: 1rem;
		  object-fit: cover;
	  }
  }

  /* ====================================================== */

  .section {
	  display: grid;
	  gap: 2rem;
  }

  .with-background {
	  position: relative;
  }

  .with-background::before {
	  --hero-bg: var(--bg-image-subtle-2);

	  content: '';
	  position: absolute;
	  pointer-events: none;
	  left: 50%;
	  width: 100vw;
	  aspect-ratio: calc(2.25 / var(--bg-scale));
	  top: 0;
	  transform: translateY(-75%) translateX(-50%);
	  background:
		  url('/tymultiverse/assets/backgrounds/noise.png') top center/220px repeat,
		  var(--hero-bg) center center / var(--bg-gradient-size) no-repeat,
		  var(--gray-999);
	  background-blend-mode: overlay, normal, normal, normal;
	  mix-blend-mode: var(--bg-blend-mode);
	  z-index: -1;
  }

  .with-background.bg-variant::before {
	  --hero-bg: var(--bg-image-subtle-1);
  }

  .section-header {
	  justify-self: center;
	  text-align: center;
	  max-width: 50ch;
	  font-size: var(--text-md);
	  color: var(--gray-300);
  }

  .section-header h5 {
	  font-size: var(--text-2xl);
  }

  @media (min-width: 50em) {
	  .section {
		  grid-template-columns: repeat(4, 1fr);
		  grid-template-areas: 'header header header header' 'gallery gallery gallery gallery';
		  gap: 5rem;
	  }

	  .section.with-cta {
		  grid-template-areas: 'header header header cta' 'gallery gallery gallery gallery';
	  }

	  .section-header {
		  grid-area: header;
		  font-size: var(--text-lg);
	  }

	  .section-header h5 {
		  font-size: var(--text-4xl);
	  }

	  .with-cta .section-header {
		  justify-self: flex-start;
		  text-align: left;
	  }

	  .gallery {
		  grid-area: gallery;
	  }

	  .cta {
		  grid-area: cta;
	  }
  }

  /* ====================================================== */

  .mention-card {
	  display: flex;
	  height: 7rem;
	  justify-content: center;
	  align-items: center;
	  text-align: center;
	  border: 1px solid var(--gray-800);
	  border-radius: 1.5rem;
	  color: var(--gray-300);
	  background: var(--gradient-subtle);
	  box-shadow: var(--shadow-sm);
  }

  @media (min-width: 50em) {
	  .mention-card {
		  border-radius: 1.5rem;
		  height: 9.5rem;
	  }
  }

.categories {
    font-family: Arial, sans-serif;
	max-width: 40%;
	width: 100%; 
}
.categories .category h5 {
    margin-bottom: -5px; 
	margin-top: 5px; 
}

.categories .pill {
    margin: 1px 1px 1px 0; 
}
h5 {
    color: #6e6e6e;
    margin-bottom: 10px;
}

.pill {
    display: inline-block;
    margin: 5px 10px 5px 0;
    padding: 5px 10px;
    border-radius: 20px;
    color: #fff;
    font-size: 14px;
	transition: transform 0.3s ease;
}

.pill:hover {
    transform: scale(1.2); 
}

:root {
    --shade1: #e0f7ff;
    --shade2: #b3e8ff;
    --shade3: #80d8ff;
    --shade4: #4dc9ff;
    --shade5: #1abfff; 
}

.pill1 {
    background-color: #b06c13;
}

.pill2 {
    background-color: #b7a414;
}

.pill3 {
    background-color: #306998;
}

.pill4 {
    background-color: #47a248;
}

.pill5 {
    background-color: #2496ed;
}

.pill6 {
    background-color: #0052cc;
}

.pill7 {
    background-color: #671f74;
}

.pill8 {
    background-color: #6e1431;
}

.pill9 {
    background-color: #146e66;
}

</style>
</head>

<body>
<!-- Messenger Chat Plugin Code -->
<div id="fb-root"></div>

<!-- Your Chat Plugin code -->
<div id="fb-customer-chat" class="fb-customerchat">
</div>
<BaseLayout>
	{showLoginAlert && 
		<script is:inline>
			document.addEventListener('DOMContentLoaded', function() {
				window.Swal.fire({
					title: '請先登入',
					icon: 'info',
					timer: 1000,
					showConfirmButton: false
				});
			});
		</script>
	}
	<div class="stack gap-20 lg:gap-48">
		
		<div class="wrapper stack gap-20 lg:gap-50">
			
			<header class="hero">
				
				<Hero
					title="TY's Outerspace"
					tagline="The Future is Now"
					align="start"
				>
					<div id="version-display" style="font-size: 0.65em; color: #888; margin-top: -1rem; margin-bottom: 1rem;">
						version 2.0<br>人次: 0
					</div>
					<script define:vars={{ serverStartTime }}>
						// 初始版本號
						const baseVersion = 2.0;
						
						// 從 localStorage 獲取訪問次數
						let visits = parseInt(localStorage.getItem('visitCount') || '0');
						visits++;
						localStorage.setItem('visitCount', visits.toString());
						
						// 計算經過的天數
						const daysPassed = Math.floor((new Date().getTime() - new Date(serverStartTime).getTime()) / (1000 * 60 * 60 * 24));
						const versionIncrement = Math.floor(daysPassed / 5) * 0.1; // 每5天增加0.1
						const newVersion = (baseVersion + versionIncrement).toFixed(1);
						
						// 更新顯示
						document.getElementById('version-display').innerHTML = 
							`version ${newVersion}<br>人次: ${visits}`;
					</script>
					<div class="roles">
						<Pill><Icon icon="code" size="1.33em" /> Backend</Pill>
						<Pill><Icon icon="pencil-line" size="1.33em" /> DevOps</Pill>
						<Pill><Icon icon="microphone-stage" size="1.33em" /> PM</Pill>
						
					</div>

					<div style="display: flex; align-items: center max-width: 95%;">
						<div class="roles-image">
							<img src="https://github-readme-stats.vercel.app/api/top-langs/?username=Vinskao" alt="Top Languages" style="width: 95%; height: auto;">
						</div>
						<div class="categories">
							<!-- 項目 1 -->
							<div class="category">
								<h5>Backend</h5>
								<span class="pill pill1 shade1">Java</span>
								<span class="pill pill1 shade3">Python</span>
								<span class="pill pill1 shade3">Node.js
								</span>
								<span class="pill pill1 shade3">PHP
								</span>
								<span class="pill pill1 shade5">Rust</span>
								<span class="pill pill1 shade3">Spring</span>
								<span class="pill pill1 shade3">Quarkus</span>
								<span class="pill pill1 shade2">Spring Boot</span>
								<span class="pill pill1 shade4">Django Rest</span>
								<span class="pill pill1 shade1">JPA</span>
								<span class="pill pill1 shade1">Mybatis</span>
								<span class="pill pill1 shade1">JDBCTemplate</span>
								<span class="pill pill1 shade1">Java Keystore</span>
								<span class="pill pill1 shade1">Swagger</span>
								<span class="pill pill1 shade2">JUnit</span>
								<span class="pill pill1 shade3">Mokito</span>
								<span class="pill pill1 shade4">Mongoose.js</span>
								<span class="pill pill1 shade4">Express.js
								</span>
							</div>
						
							<!-- 項目 2 -->
							<div class="category">
								<h5>Frontend</h5>
								<span class="pill pill2 shade1">JavaScript</span>
								<span class="pill pill2 shade2">Vue.js</span>
								<span class="pill pill2 shade3">React.js</span>
								<span class="pill pill2 shade1">jQuery</span>
								<span class="pill pill2 shade1">AJAX</span>
								<span class="pill pill2 shade5">Jest</span>
								<span class="pill pill2 shade2">Astro</span>
								<span class="pill pill2 shade2">Handlebars</span>
								<span class="pill pill2 shade2">Thymeleaf</span>
								<span class="pill pill2 shade2">CKEditor</span>
							</div>
						
							<!-- 項目 3 -->
							<div class="category">
								<h5>AI</h5>
								<span class="pill pill3 shade5">LangChain</span>
								<span class="pill pill3 shade5">Ollama</span>
								<span class="pill pill3 shade4">OpenAI API</span>
							</div>
						
							<!-- 項目 4 -->
							<div class="category">
								<h5>DB</h5>
								<span class="pill pill4 shade4">Firebase</span>
								<span class="pill pill4 shade4">MongoDB</span>
								<span class="pill pill4 shade1">PostgreSQL</span>
								<span class="pill pill4 shade1">MSSQL</span>
								<span class="pill pill4 shade1">SQLite</span>
							</div>
						
							<!-- 項目 5 -->
							<div class="category">
								<h5>Infra</h5>
								<span class="pill pill5 shade1">Docker</span>
								<span class="pill pill5 shade1">Podman</span>
								<span class="pill pill5 shade1">Linux</span>
								<span class="pill pill5 shade2">JBoss</span>
								<span class="pill pill5 shade4">Terraform</span>
								<span class="pill pill5 shade2">Bare Metal K8S</span>
								<span class="pill pill5 shade5">OCP K8S</span>
								<span class="pill pill5 shade4">Ansible</span>
								<span class="pill pill5 shade3">Tomcat</span>
								<span class="pill pill5 shade4">Grafana</span>
								<span class="pill pill5 shade4">Prometheus</span>
								<span class="pill pill5 shade4">Kiali</span>
								<span class="pill pill5 shade3">Jolokia</span>
							</div>
						
							<!-- 項目 6 -->
							<div class="category">
								<h5>Network</h5>
								<span class="pill pill6 shade4">Istio</span>
								<span class="pill pill6 shade1">Ingress</span>
								<span class="pill pill6 shade2">Nginx Ingress Controller</span>
								<span class="pill pill6 shade2">Nginx</span>
								<span class="pill pill6 shade3">WebSocket</span>
							</div>

							<!-- 項目 7 -->
							<div class="category">
								<h5>Cloud</h5>
								<span class="pill pill7 shade3">OCI</span>
								<span class="pill pill7 shade5">GCP</span>
							</div>

							<!-- 項目 8 -->
							<div class="category">
								<h5>Tool</h5>
								<span class="pill pill8 shade2">WordPress</span>
							</div>

							<!-- 項目 9 -->
							<div class="category">
								<h5>Security</h5>
								<span class="pill pill9 shade2">Keycloak</span>
								<span class="pill pill9 shade4">Keycloak SPI</span>
								<span class="pill pill9 shade3">RedHat SSO</span>
								<span class="pill pill9 shade2">Authorization Code Flow</span>
								<span class="pill pill9 shade2">JWT</span>
								<span class="pill pill9 shade3">Spring Security</span>
								<span class="pill pill9 shade3">Digital Signature</span>
								</span>
							</div>
						</div>
					</div>

				</Hero>
				<div class="video-container">
					<div class="github-graph">
						<h5>Github Contributions</h5>
						<div>
							<img src="https://ghchart.rshah.org/VinsKao" alt="VinsKao's Github chart" style="object-fit: contain;"/>
						</div>
					</div>
					<video autoplay loop muted playsinline style="width: 100%; height: auto; border-radius: 2.5rem; box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.4); object-fit: contain;">
						<source src="/tymultiverse/assets/protrait.mp4" type="video/mp4">
						Your browser does not support the video tag.
					</video>
					<div class="text-overlay">
						WhoAmI: 
						</br>
						Hello TY!
					</div>

				</div>
				
			</header>

			<Skills />

		</div>

		<main class="wrapper stack gap-20 lg:gap-48">
			<section class="section with-background with-cta">
				<header class="section-header stack gap-2 lg:gap-4">
					<h5>Collections</h5>
					<p>Recent Notes</p>
				</header>

				<div class="gallery">
					<Grid variant="offset">
						{
							projects.map((project) => (
								<li>
									<PortfolioPreview project={project} />
								</li>
							))
						}
					</Grid>
				</div>

				<div class="cta">
					<CallToAction href="/tymultiverse/work/">
						View All
						<Icon icon="arrow-right" size="1.2em" />
					</CallToAction>
				</div>
			</section>

			<section class="section with-background bg-variant">
				<header class="section-header stack gap-2 lg:gap-4">
					<h5>Mentions</h5>
					<p>
						To be Continued...
					</p>
				</header>

				<div class="gallery">
					<Grid variant="small">
						{
							['Who', 'Am', 'I'].map((brand) => (
								<li class="mention-card">
									<p>{brand}</p>
								</li>
							))
						}
					</Grid>
				</div>
			</section>
		</main>

		<ContactCTA />
	</div>
</BaseLayout>



</body>
<script>

// 加上tooltip
document.addEventListener("DOMContentLoaded", () => {
    // 定義提示文字
    const shadeDescriptions = {
        shade1: "Score 5 Strong",
        shade2: "Score 4 Sufficient",
        shade3: "Score 3 Understood",
        shade4: "Score 2 Applicable",
        shade5: "Score 1 Basic",
    };

    // 分數映射
    const shadeScores = {
        shade1: 5,
        shade2: 4,
        shade3: 3,
        shade4: 2,
        shade5: 1,
    };

    // 計算每個類別的總分數
    function calculateCategoryScores() {
        const categories = document.querySelectorAll('.category');
        
        categories.forEach((category) => {
            const pills = category.querySelectorAll('.pill');
            let totalScore = 0;
            
            pills.forEach((pill) => {
                const shadeClass = [...pill.classList].find((cls) => cls.startsWith("shade"));
                if (shadeClass && shadeScores[shadeClass]) {
                    totalScore += shadeScores[shadeClass];
                }
            });
            
            // 找到類別標題
            const title = category.querySelector('h5');
            if (title) {
                // 添加總分 - 改為小字格式
                title.innerHTML = `${title.textContent} <sup style="font-size: 0.65em; color: #888; margin-left: 4px;">${totalScore}</sup>`;
            }
        });
    }

    // 建立提示框元素
    const tooltip = document.createElement("div");
    tooltip.style.position = "absolute";
    tooltip.style.padding = "5px 10px";
    tooltip.style.backgroundColor = "#333";
    tooltip.style.color = "#fff";
    tooltip.style.borderRadius = "4px";
    tooltip.style.fontSize = "12px";
    tooltip.style.display = "none";
    tooltip.style.zIndex = "1000";
    tooltip.style.pointerEvents = "none";
    document.body.appendChild(tooltip);

    // 處理 hover 事件
    const pills = document.querySelectorAll(".pill");
    pills.forEach((pill) => {
        const shadeClass = [...pill.classList].find((cls) => cls.startsWith("shade"));
        if (shadeClass && shadeDescriptions[shadeClass]) {
            // 滑鼠進入
            pill.addEventListener("mouseenter", (e) => {
                tooltip.textContent = shadeDescriptions[shadeClass];
                tooltip.style.display = "block";
                const rect = (e.target as HTMLElement).getBoundingClientRect();
                tooltip.style.left = `${rect.left + window.scrollX}px`;
                tooltip.style.top = `${rect.top + window.scrollY - tooltip.offsetHeight - 5}px`;
            });

            // 滑鼠移動
            pill.addEventListener("mousemove", (e: MouseEvent) => {
                tooltip.style.left = `${e.pageX}px`;
                tooltip.style.top = `${e.pageY - tooltip.offsetHeight - 5}px`;
            });

            // 滑鼠離開
            pill.addEventListener("mouseleave", () => {
                tooltip.style.display = "none";
            });
        }
    });

    // 計算並顯示分數
    calculateCategoryScores();
});


// HEX to RGB 顏色轉換
function hexToRgb(hex: string): { r: number; g: number; b: number } {
    const bigint = parseInt(hex.slice(1), 16);
    return {
        r: (bigint >> 16) & 255,
        g: (bigint >> 8) & 255,
        b: bigint & 255,
    };
}

// RGB to HSL 顏色轉換
function rgbToHsl(r: number, g: number, b: number): { h: number; s: number; l: number } {
    r /= 255;
    g /= 255;
    b /= 255;

    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    const delta = max - min;

    let h = 0;
    let s = 0;
    const l = (max + min) / 2;

    if (delta !== 0) {
        s = delta / (1 - Math.abs(2 * l - 1));
        switch (max) {
            case r:
                h = ((g - b) / delta + (g < b ? 6 : 0)) % 6;
                break;
            case g:
                h = (b - r) / delta + 2;
                break;
            case b:
                h = (r - g) / delta + 4;
                break;
        }
        h *= 60;
    }

    return { h, s: s * 100, l: l * 100 };
}

// HSL to HEX 顏色轉換
function hslToHex(h: number, s: number, l: number): string {
    s /= 100;
    l /= 100;

    const c = (1 - Math.abs(2 * l - 1)) * s;
    const x = c * (1 - Math.abs((h / 60) % 2 - 1));
    const m = l - c / 2;

    let r = 0,
        g = 0,
        b = 0;

    if (h >= 0 && h < 60) {
        r = c;
        g = x;
        b = 0;
    } else if (h >= 60 && h < 120) {
        r = x;
        g = c;
        b = 0;
    } else if (h >= 120 && h < 180) {
        r = 0;
        g = c;
        b = x;
    } else if (h >= 180 && h < 240) {
        r = 0;
        g = x;
        b = c;
    } else if (h >= 240 && h < 300) {
        r = x;
        g = 0;
        b = c;
    } else if (h >= 300 && h < 360) {
        r = c;
        g = 0;
        b = x;
    }

    r = Math.round((r + m) * 255);
    g = Math.round((g + m) * 255);
    b = Math.round((b + m) * 255);

    return `#${((1 << 24) | (r << 16) | (g << 8) | b).toString(16).slice(1)}`;
}

// 調整顏色的函數 (從原色到黑色漸層)
function adjustColorToBlack(hex, shadeLevel) {
    const rgb = hexToRgb(hex);
    
    // 計算漸層比例 (shade1 = 0%, shade5 = 100%)
    const factor = (shadeLevel - 1) / 4;
    
    // 將顏色向黑色漸變
    return {
        r: Math.round(rgb.r * (1 - factor)),
        g: Math.round(rgb.g * (1 - factor)),
        b: Math.round(rgb.b * (1 - factor))
    };
}

// 初始化 shade 與 pill 顏色
function applyShadesToPills() {
    const pills = document.querySelectorAll('.pill') as NodeListOf<HTMLElement>;

    pills.forEach((pill) => {
        const baseColor = getComputedStyle(pill).backgroundColor;
        const shadeClass = [...pill.classList].find((cls) => cls.startsWith('shade'));
        if (shadeClass) {
            const shadeLevel = parseInt(shadeClass.replace('shade', ''), 10);
            const adjustedColor = adjustColorToBlack(rgbToHex(baseColor), shadeLevel);
            pill.style.backgroundColor = `rgb(${adjustedColor.r}, ${adjustedColor.g}, ${adjustedColor.b})`;
        }
    });
}

document.addEventListener('DOMContentLoaded', () => {
    applyShadesToPills();
});

// 將 RGB 顏色轉為 HEX 的輔助函數
function rgbToHex(rgb: string): string {
    const match = rgb.match(/\d+/g);
    if (!match) throw new Error('Invalid RGB color');
    const [r, g, b] = match.map(Number);
    return (
        '#' +
        ((1 << 24) + (r << 16) + (g << 8) + b)
            .toString(16)
            .slice(1)
            .toUpperCase()
    );
}
</script>