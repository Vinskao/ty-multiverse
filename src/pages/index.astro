---
import { getCollection } from 'astro:content';
import algorithmsData from '../storages/algorithmsUsed.json';
import skillsData from '../storages/skills.json';

// Layout import — provides basic page elements: <head>, <nav>, <footer> etc.
import BaseLayout from '../layouts/BaseLayout.astro';

// Component Imports
import CallToAction from '../components/CallToAction.astro';
import Grid from '../components/Grid.astro';
import Hero from '../components/Hero.astro';
import { Icon } from '../components/Icon';
import Pill from '../components/Pill.astro';
import PortfolioPreview from '../components/PortfolioPreview.astro';

// Page section components
import ContactCTA from '../components/ContactCTA.astro';
import Skills from '../components/Skills.astro';
import '../styles/index.css';
// Content Fetching: List four most recent work projects
const projects = (await getCollection('work'))
	.sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
	.slice(0, 4);

// 修改服務器啟動時間的處理
let serverStartTime = new Date().toISOString();
try {
    // 使用環境變量或默認值
    serverStartTime = import.meta.env.SERVER_START_TIME || serverStartTime;
} catch (error) {
    console.error('Error getting server start time:', error);
}

// 檢查是否需要顯示登入提示
const showLoginAlert = Astro.url.searchParams.get('showLoginAlert') === 'true';

const algorithmsUsed = algorithmsData.algorithms;
const skillsCategories = skillsData.categories;

// Full Astro Component Syntax:
// https://docs.astro.build/core-concepts/astro-components/
---
<meta charset="UTF-8" />
<head>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kalam&display=swap">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.15.1/devicon.min.css">
          
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js" async></script>

</head>

<body>
<!-- Messenger Chat Plugin Code -->
<div id="fb-root"></div>

<!-- Your Chat Plugin code -->
<div id="fb-customer-chat" class="fb-customerchat">
</div>
<BaseLayout>
	{showLoginAlert && 
		<script is:inline>
			document.addEventListener('DOMContentLoaded', function() {
				window.Swal.fire({
					title: '請先登入',
					icon: 'info',
					timer: 1000,
					showConfirmButton: false
				});
			});
		</script>
	}
	<div class="stack gap-20 lg:gap-48">
		
		<div class="wrapper stack gap-20 lg:gap-50">
			
			<header class="hero stack hero-layout">
				<div class="hero-main">
					<div class="hero-header">
						<h1>TY's Outerspace</h1>
						<p>The Future is Now</p>
						<p class="visit-counter">You are the <span id="visit-count">...</span> visitor!</p>
					</div>
					<div class="hero-content">
						<div class="github-stats">
							<div class="roles-image">
								<img src="https://github-readme-stats.vercel.app/api?username=vinskao&show_icons=true&theme=light" alt="GitHub Stats">
							</div>
							<div class="roles-image">
								<img src="https://github-readme-stats.vercel.app/api/top-langs/?username=vinskao&layout=compact&hide=astro,css,html" alt="Top Languages">
							</div>
						</div>

						<div class="categories">
							{skillsCategories.map((category) => (
								<div class="category">
									<h5>{category.name}</h5>
									<div class="pills-container">
										{category.skills.map((skill) => (
											<span class={`pill ${category.pillClass} ${skill.level} ${skill.specialClass || ''}`}>
												{skill.name}
											</span>
										))}
									</div>
								</div>
							))}
						</div>
					</div>
				</div>

				<div class="hero-side">
					<div class="video-container">
						<div class="roles">
							<Pill><Icon icon="code" size="1.33em" /> Backend</Pill>
							<Pill><Icon icon="code" size="1.33em" /> Frontend</Pill>
							<Pill><Icon icon="pencil-line" size="1.33em" /> DevOps</Pill>
							<Pill><Icon icon="microphone-stage" size="1.33em" /> PM</Pill>
						</div>
						<div class="github-graph">
							<h5>Github Contributions</h5>
							<div>
								<img src="https://ghchart.rshah.org/VinsKao" alt="VinsKao's Github chart" />
							</div>
						</div>

						<img src="/tymultiverse/assets/protrait.jpeg" alt="Portrait" class="portrait-image" />

						<div class="leetcode-graph">
							<h5>LeetCode Stats</h5>
							<div id="leetcode-stats" class="leetcode-container">
								<div class="leetcode-card">
									<h6>Total Solved</h6>
									<p id="total-solved">Loading...</p>
									<div class="progress-bar">
										<div id="total-progress"></div>
									</div>
								</div>
								<div class="leetcode-card">
									<h6>Easy</h6>
									<p id="easy-solved">Loading...</p>
									<div class="progress-bar">
										<div id="easy-progress"></div>
									</div>
								</div>
								<div class="leetcode-card">
									<h6>Medium</h6>
									<p id="medium-solved">Loading...</p>
									<div class="progress-bar">
										<div id="medium-progress"></div>
									</div>
								</div>
								<div class="leetcode-card">
									<h6>Hard</h6>
									<p id="hard-solved">Loading...</p>
									<div class="progress-bar">
										<div id="hard-progress"></div>
									</div>
								</div>
							</div>
						</div>

                        <div class="algorithms-section">
                            <h5>Patterns Learned</h5>
                            <div class="algorithms-list">
                                {algorithmsUsed.map((algo) => (
                                    <span class="pill algo-pill" data-explanation={algo.explanation}>{algo.name}</span>
                                ))}
                            </div>
                        </div>
					</div>
				</div>

				
			</header>

			<Skills />

		</div>

		<main class="wrapper stack gap-20 lg:gap-48">
			<section class="section with-background with-cta">
				<header class="section-header stack gap-2 lg:gap-4">
					<h5>Collections</h5>
					<p>Recent Notes</p>
				</header>

				<div class="gallery">
					<Grid variant="offset">
						{
							projects.map((project) => (
								<li>
									<PortfolioPreview project={project} />
								</li>
							))
						}
					</Grid>
				</div>

				<div class="cta">
					<CallToAction href="/tymultiverse/work/">
						View All
						<Icon icon="arrow-right" size="1.2em" />
					</CallToAction>
				</div>
			</section>

			<section class="section with-background bg-variant">
				<header class="section-header stack gap-2 lg:gap-4">
					<h5>Mentions</h5>
					<p>
						To be Continued...
					</p>
				</header>

				<!-- <div class="gallery">
					<Grid variant="small">
						{
							['Who', 'Am', 'I'].map((brand) => (
								<li class="mention-card">
									<p>{brand}</p>
								</li>
							))
						}
					</Grid>
				</div> -->
			</section>
		</main>

		<ContactCTA />
	</div>
</BaseLayout>

<script src="../scripts/index.js"></script>
</body>