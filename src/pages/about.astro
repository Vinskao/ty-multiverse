---
import BaseLayout from "../layouts/BaseLayout.astro";

import ContactCTA from "../components/ContactCTA.astro";
import Hero from "../components/Hero.astro";
import '../styles/about.css';

// Import the JSON data
import aboutData from '../storages/about.json';
import skillsData from '../storages/skills.json';

---

<meta charset="UTF-8" />

<body>
  <BaseLayout title="About | Tianyi Kao" description="About Tianyi Kao">
    <div class="stack gap-20">
      <main class="wrapper about">
        <div class="hero-section">
          <Hero
            title="About"
            tagline="Memories"
          >
            <div class="content">
            </div>
          </Hero>
          <img
            width="1553"
            height="873"
            src="/tymultiverse/assets/at-work.jpg"
            alt="Tianyi Kao at work with a colleague"
            class="work-photo"
          />
        </div>

        <section>
          <h2 class="section-title">Background</h2>
          <div class="content background-content">
            <div class="name-section">
              <h1 class="majestic-name">KAO TIAN YI</h1>
              <p class="email">tianyikao@gmail.com</p>
            </div>
            <p set:html={aboutData.background.replace(/\n/g, '<br>')}>
            </p>
          </div>
        </section>
        
        <section>
          <h2 class="section-title">Experience</h2>
          <div class="content">
            {aboutData.experience.map((job) => (
              <div class="experience-item">
                <div class="job-header">
                  <h3>{job.title}</h3>
                  <div class="job-meta">
                    <span class="company">{job.company}</span>
                    <span class="period">{job.period}</span>
                  </div>
                </div>
                
                {job.projectExperience && (
                  <div class="project-experience">
                    <h4>Project Experience</h4>
                    <ul>
                      {job.projectExperience.map((project) => (
                        <li>{project}</li>
                      ))}
                    </ul>
                  </div>
                )}
                
                {job.responsibilities && (
                  <div class="responsibilities">
                    <ul>
                      {job.responsibilities.map((responsibility) => (
                        <li>{responsibility}</li>
                      ))}
                    </ul>
                  </div>
                )}
                
                {job.title === "Open Source Backend Engineer" && (
                  <div class="skills-section">
                    {skillsData.categories.map((category) => (
                      <div class="skill-category">
                        <h5>{category.name}</h5>
                        {category.subcategories ? (
                          category.subcategories.map((subcategory) => (
                            <div class="skill-subcategory">
                              <h6>{subcategory.name}</h6>
                              <div class="skill-tags">
                                {subcategory.skills.map((skill) => {
                                  const gradeMap = {
                                    'shade1': 'S',
                                    'shade2': 'A', 
                                    'shade3': 'B',
                                    'shade4': 'C',
                                    'shade5': 'D'
                                  };
                                  return (
                                    <span class={`pill ${category.pillClass} ${skill.level} ${(skill as any).specialClass || ''}`} 
                                          data-tooltip={`Level: ${gradeMap[skill.level] || skill.level}`}>
                                      {skill.name}
                                    </span>
                                  );
                                })}
                              </div>
                              {(subcategory as any).description && (subcategory as any).description.length > 0 && (
                                <p class="skill-subdescription">
                                  {(subcategory as any).description.map((desc: string, index: number) => (
                                    <span set:html={desc.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" style="color: #007bff; text-decoration: underline;">$1</a>')}>
                                    </span>
                                  ))}
                                </p>
                              )}
                              
                              {subcategory.name === "Frameworks & Libraries" && (
                                <div class="mermaid-diagram">
                                  <pre class="mermaid">
                                    sequenceDiagram
                                        participant Service
                                        participant Factory
                                        participant Cache
                                        participant ApplicationContext
                                        participant Repository
                                        
                                        Service->>Factory: Request Instance
                                        Factory->>Cache: Check Cache
                                        alt Cache Hit
                                            Cache-->>Factory: Return Cached Instance
                                        else Cache Miss
                                            Factory->>ApplicationContext: Get Bean
                                            ApplicationContext-->>Factory: Return Bean
                                            Factory->>Cache: Store in Cache
                                        end
                                        Factory-->>Service: Return Instance
                                        Service->>Repository: Use Instance
                                  </pre>
                                </div>
                              )}
                              {subcategory.name === "Platforms" && (
                                <div class="mermaid-diagram">
                                  <pre class="mermaid">
                                    graph TB
                                        Internet[Internet]
                                        
                                        subgraph OCI_VCN_10_0_0_0_16["OCI VCN (10.0.0.0/16)"]
                                            subgraph Public_Subnet_10_0_0_0_24["Public Subnet (10.0.0.0/24)"]
                                                node1[node1\nControlPlane\n10.0.0.11\n+ Public IP]
                                                node2[node2\nWorker\n10.0.0.12\n+ Public IP]
                                                node3[node3\nWorker\n10.0.0.13\n+ Public IP]
                                                node4[node4\nWorker\n10.0.0.14\n+ Public IP]
                                            end

                                            IG[Internet Gateway]
                                            SL[Security List\nIngress: 0.0.0.0/0\nEgress: 0.0.0.0/0]
                                        end

                                        Internet --> IG
                                        IG --> SL
                                        SL --> node1
                                        SL --> node2
                                        SL --> node3
                                        SL --> node4
                                  </pre>
                                </div>
                              )}
                              {subcategory.name === "NoSQL" && (
                                <div class="mermaid-diagram">
                                  <pre class="mermaid">
                                    sequenceDiagram
                                        participant Frontend as Frontend
                                        participant Django as Django API
                                        participant Redis as Redis Queue
                                        participant Consumer as Consumer Service
                                        participant Mongo as MongoDB

                                        Frontend->>Django: 1. Call Push API
                                        Django->>Redis: 2. Push to Redis List
                                        Consumer->>Redis: 3. Pop from Redis List
                                        Consumer->>Mongo: 4. Update Increment in Document
                                        Frontend->>Django: 5. Call Count API
                                        Django->>Mongo: 6. Query Count from Document
                                        Mongo-->>Django: Return Count
                                        Django-->>Frontend: Return Count

                                        Note over Frontend,Mongo: Asynchronous Visit Count Processing
                                        Note over Redis,Consumer: Using Consumer YAML Configuration
                                  </pre>
                                </div>
                              )}
                            </div>
                          ))
                        ) : (
                          <div class="skill-tags">
                            {category.skills.map((skill) => {
                              const gradeMap = {
                                'shade1': 'S',
                                'shade2': 'A', 
                                'shade3': 'B',
                                'shade4': 'C',
                                'shade5': 'D'
                              };
                              return (
                                <span class={`pill ${category.pillClass} ${skill.level} ${(skill as any).specialClass || ''}`} 
                                      data-tooltip={`Level: ${gradeMap[skill.level] || skill.level}`}>
                                  {skill.name}
                                </span>
                              );
                            })}
                          </div>
                        )}
                        {(category as any).description && (category as any).description.length > 0 && (
                          <p class="skill-description">
                            {(category as any).description.map((desc: string, index: number) => (
                              <span set:html={desc.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" style="color: #007bff; text-decoration: underline;">$1</a>')}>
                              </span>
                            ))}
                          </p>
                        )}
                        
                        {category.name === "CI/CD" && (
                          <div class="mermaid-diagram">
                            <pre class="mermaid">
                              graph LR
                                  A[GitHub Repository] --> B[Clone and Setup]
                                  B --> C[Build with Node.js]
                                  C --> D[Build Docker Image with BuildKit]
                                  D --> E[Push to Docker Hub]
                                  E --> F[Deploy to Kubernetes]
                            </pre>
                          </div>
                        )}
                        
                        {category.name === "Security & Authentication" && (
                          <div class="mermaid-diagram">
                            <pre class="mermaid">
                              sequenceDiagram
                                  participant User as User
                                  participant App as Application
                                  participant Auth as Authorization Server
                                  participant API as Resource Server
                                  
                                  User->>App: 1. Access Application
                                  App->>Auth: 2. Redirect to Authorization Page
                                  User->>Auth: 3. Login and Authorize
                                  Auth->>App: 4. Return Authorization Code
                                  App->>Auth: 5. Exchange Code for Token
                                  Auth->>App: 6. Return Access Token
                                  App->>API: 7. Access Resources with Token
                                  API->>App: 8. Return Protected Resources
                            </pre>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                )}
              </div>
            ))}
          </div>
        </section>

        <section>
          <h2 class="section-title">Education</h2>
          <div class="content education-container" style="max-height: 25vh; overflow-y: auto;">
            {aboutData.education.map((item) => (
              <div class="education-item" id={item.institution === "iSpan" ? "iSpan" : ""}>
                <div class="education-header">
                  <h3>{item.institution}</h3>
                  <span class="education-period">{item.period}</span>
                </div>
                <ul>
                  {item.programs.map((program) => (
                    <li>{program}</li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        </section>
        
      </main>

      <div class="pdf-export-section">
        <button id="export-pdf-btn" class="export-btn">Export PDF Resume</button>
      </div>

      <ContactCTA />
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
      // TypeScript declaration for mermaid
      declare const mermaid: any;
      
      // Initialize Mermaid after the script is loaded
      document.addEventListener('DOMContentLoaded', function() {
        if (typeof mermaid !== 'undefined') {
          mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
              useMaxWidth: false,
              htmlLabels: true
            },
            classDiagram: {
              useMaxWidth: false,
              htmlLabels: true
            },
            sequence: {
              useMaxWidth: false,
              htmlLabels: true
            }
          });
        }
      });
    </script>

    <script define:vars={{ aboutData, skillsData }}>
      // Simple PDF Export functionality
      document.getElementById('export-pdf-btn')?.addEventListener('click', async () => {
        const btn = document.getElementById('export-pdf-btn');
        if (!btn) return;

        try {
          btn.textContent = 'Generating PDF...';
          btn.disabled = true;

          await new Promise(resolve => setTimeout(resolve, 2000));

          const printWindow = window.open('', '_blank');
          if (!printWindow) {
            throw new Error('Failed to open print window');
          }

          // Use the data directly from JSON instead of extracting from DOM
          const backgroundText = aboutData.background.replace(/\n/g, '<br>');
          
          const experienceItems = aboutData.experience.map(job => {
            const skills = job.title === "Open Source Backend Engineer" ? 
              skillsData.categories.map(category => {
                const categoryDescription = category.description ? category.description.join('<br>') : '';
                const subcategories = category.subcategories ? 
                  category.subcategories.map(subcategory => {
                    const subDescription = subcategory.description ? subcategory.description.join('<br>') : '';
                    const pills = subcategory.skills.map(skill => {
                      const gradeMap = {
                        'shade1': 'S',
                        'shade2': 'A', 
                        'shade3': 'B',
                        'shade4': 'C',
                        'shade5': 'D'
                      };
                      return {
                        text: skill.name,
                        classes: `pill ${category.pillClass} ${skill.level} ${skill.specialClass || ''}`,
                        tooltip: `Level: ${gradeMap[skill.level] || skill.level}`
                      };
                    });
                    
                    return { 
                      name: subcategory.name, 
                      description: subDescription, 
                      skills: pills
                    };
                  }) : [];
                  
                return { 
                  name: category.name, 
                  description: categoryDescription, 
                  subcategories
                };
              }) : [];
            return { 
              title: job.title, 
              company: job.company, 
              period: job.period, 
              projectExp: job.projectExperience || [], 
              responsibilities: job.responsibilities || [], 
              skills 
            };
          });
          const educationItems = aboutData.education.map(item => ({
            institution: item.institution,
            period: item.period,
            programs: item.programs
          }));

          const pdfContent = `
            <!DOCTYPE html>
            <html>
            <head>
              <meta charset="UTF-8">
              <title>Tianyi Kao - Resume</title>
              <style>
                @page { size: A4; margin: 1cm; }
                body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.6; color: #333; background: white; margin: 0; padding: 20px; }
                .resume-section { margin-bottom: 2rem; page-break-inside: avoid; }
                .section-title { font-size: 1.5rem; color: #333; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; text-align: center; margin: 0 auto 1.5rem auto; border-bottom: 2px solid #514695; padding-bottom: 0.5rem; }
                .content { width: 100%; line-height: 1.8; font-size: 1.1rem; color: #333; }
                .background-content { text-align: center; }
                .name-section { text-align: center; margin: 1rem 0; padding: 1rem 0; border-bottom: 2px solid #ddd; }
                .majestic-name { font-size: 3.5rem; font-weight: 700; letter-spacing: 0.2em; margin: 0 0 1rem 0; color: #333; font-family: 'Georgia', serif; line-height: 1.2; }
                .email { font-size: 1.1rem; color: #666; margin: 0; font-weight: 300; letter-spacing: 0.05em; }
                .experience-item { margin-bottom: 2.5rem; padding: 2rem; background: #f9f9f9; border-radius: 12px; border-left: 4px solid #514695; }
                .job-header { margin-bottom: 1.5rem; }
                .job-header h3 { margin-bottom: 0.5rem; color: #514695; font-size: 1.4rem; font-weight: 600; }
                .job-meta { display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; font-size: 0.95rem; }
                .company { font-weight: 600; color: #333; }
                .period { color: #666; font-style: italic; }
                .project-experience, .responsibilities { margin-bottom: 1.5rem; }
                .project-experience h4, .skills-section h4 { color: #333; font-size: 1.1rem; margin-bottom: 1rem; font-weight: 600; }
                .project-experience ul, .responsibilities ul { list-style-type: none; padding-left: 0; }
                .project-experience li, .responsibilities li { position: relative; padding-left: 1.5rem; margin-bottom: 0.8rem; line-height: 1.6; color: #333; }
                .project-experience li::before, .responsibilities li::before { content: '•'; position: absolute; left: 0; color: #514695; font-weight: bold; }
                .skills-section { margin-top: 1.5rem; }
                .skill-category { margin-bottom: 1rem; }
                .skill-category h5 { color: #333; font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; padding-bottom: 0.3rem; border-bottom: 2px solid rgba(81, 70, 149, 0.3); }
                .skill-description { font-size: 0.9rem; color: #666; font-style: italic; line-height: 1.4; margin-top: 0.5rem; }
                .skill-subcategory { margin-bottom: 0.8rem; }
                .skill-subcategory h6 { color: #333; font-size: 1rem; font-weight: 500; margin-bottom: 0.4rem; padding-bottom: 0.2rem; border-bottom: 1px solid rgba(81, 70, 149, 0.2); }
                .skill-subdescription { font-size: 0.85rem; color: #666; font-style: italic; line-height: 1.4; margin-top: 0.5rem; }
                .skill-tags { display: flex; flex-wrap: wrap; gap: 0.3rem; }
                .skill-tags .pill { display: inline-block; margin: 3px 6px 3px 0; padding: 5px 10px; border-radius: 20px; color: #fff; font-size: 14px; }
                .pill1 { background-color: #b06c13; }
                .pill2 { background-color: #b7a414; }
                .pill3 { background-color: #306998; }
                .pill4 { background-color: #47a248; }
                .pill5 { background-color: #2496ed; }
                .pill6 { background-color: #0052cc; }
                .pill7 { background-color: #671f74; }
                .pill8 { background-color: #6e1431; }
                .pill9 { background-color: #146e66; }
                .pill10 { background-color: #2b5797; }
                .shade1 { opacity: 1.0; }
                .shade2 { opacity: 0.8; }
                .shade3 { opacity: 0.6; }
                .shade4 { opacity: 0.4; }
                .shade5 { opacity: 0.2; }
                .education-item { margin-bottom: 0.1rem; padding: 0.4rem; background: #f9f9f9; border-radius: 8px; }
                .education-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.1rem; }
                .education-header h3 { margin-bottom: 0; color: #514695; font-size: 1.2rem; font-weight: 600; }
                .education-period { font-size: 0.8rem; color: #666; font-style: italic; }
                .education-item ul { list-style-type: none; padding-left: 0; margin: 0; }
                .education-item li { position: relative; padding-left: 1rem; margin-bottom: 0.1rem; color: #333; font-size: 0.9rem; }
                .education-item li::before { content: '→'; position: absolute; left: 0; color: #514695; }
                .mermaid-diagram { margin-top: 0.8rem; padding: 0.5rem; background: #f5f5f5; border-radius: 12px; border: 1px solid rgba(81, 70, 149, 0.2); overflow-x: auto; }
                .mermaid-diagram .mermaid { display: flex; justify-content: center; align-items: center; min-height: 120px; }
                .mermaid-diagram svg { max-width: 100%; height: auto; }
                @media print { body { -webkit-print-color-adjust: exact; color-adjust: exact; } }
              </style>
            </head>
            <body>
              <div class="resume-section">
                <h2 class="section-title">Background</h2>
                <div class="content background-content">
                  <div class="name-section">
                    <h1 class="majestic-name">KAO TIAN YI</h1>
                    <p class="email">tianyikao@gmail.com</p>
                  </div>
                  <p>${backgroundText}</p>
                </div>
              </div>

              <div class="resume-section">
                <h2 class="section-title">Experience</h2>
                <div class="content">
                  ${experienceItems.map((job) => `
                    <div class="experience-item">
                      <div class="job-header">
                        <h3>${job.title}</h3>
                        <div class="job-meta">
                          <span class="company">${job.company}</span>
                          <span class="period">${job.period}</span>
                        </div>
                      </div>
                      ${job.projectExp.length > 0 ? `
                        <div class="project-experience">
                          <h4>Project Experience</h4>
                          <ul>
                            ${job.projectExp.map((project) => `<li>${project}</li>`).join('')}
                          </ul>
                        </div>
                      ` : ''}
                      ${job.responsibilities.length > 0 ? `
                        <div class="responsibilities">
                          <ul>
                            ${job.responsibilities.map((responsibility) => `<li>${responsibility}</li>`).join('')}
                          </ul>
                        </div>
                      ` : ''}
                      ${job.skills.length > 0 ? `
                        <div class="skills-section">
                          ${job.skills.map((category) => `
                            <div class="skill-category">
                              <h5>${category.name}</h5>
                              ${category.description ? `<p class="skill-description">${category.description}</p>` : ''}
                              ${category.subcategories.map((subcategory) => `
                                <div class="skill-subcategory">
                                  <h6>${subcategory.name}</h6>
                                  <div class="skill-tags">
                                    ${subcategory.skills.map((skill) => `<span class="pill ${skill.classes}" title="${skill.tooltip}">${skill.text}</span>`).join('')}
                                  </div>
                                  ${subcategory.description ? `<p class="skill-subdescription">${subcategory.description}</p>` : ''}
                                  ${subcategory.name === "Frameworks & Libraries" ? `
                                    <div class="mermaid-diagram">
                                      <pre class="mermaid">
sequenceDiagram
    participant Service
    participant Factory
    participant Cache
    participant ApplicationContext
    participant Repository
    
    Service->>Factory: Request Instance
    Factory->>Cache: Check Cache
    alt Cache Hit
        Cache-->>Factory: Return Cached Instance
    else Cache Miss
        Factory->>ApplicationContext: Get Bean
        ApplicationContext-->>Factory: Return Bean
        Factory->>Cache: Store in Cache
    end
    Factory-->>Service: Return Instance
    Service->>Repository: Use Instance
                                      </pre>
                                    </div>
                                  ` : ''}
                                  ${subcategory.name === "Platforms" ? `
                                    <div class="mermaid-diagram">
                                      <pre class="mermaid">
graph TB
    Internet[Internet]
    
    subgraph OCI_VCN_10_0_0_0_16["OCI VCN (10.0.0.0/16)"]
        subgraph Public_Subnet_10_0_0_0_24["Public Subnet (10.0.0.0/24)"]
            node1[node1\nControlPlane\n10.0.0.11\n+ Public IP]
            node2[node2\nWorker\n10.0.0.12\n+ Public IP]
            node3[node3\nWorker\n10.0.0.13\n+ Public IP]
            node4[node4\nWorker\n10.0.0.14\n+ Public IP]
        end

        IG[Internet Gateway]
        SL[Security List\nIngress: 0.0.0.0/0\nEgress: 0.0.0.0/0]
    end

    Internet --> IG
    IG --> SL
    SL --> node1
    SL --> node2
    SL --> node3
    SL --> node4
                                      </pre>
                                    </div>
                                  ` : ''}
                                  ${subcategory.name === "NoSQL" ? `
                                    <div class="mermaid-diagram">
                                      <pre class="mermaid">
sequenceDiagram
    participant Frontend as Frontend
    participant Django as Django API
    participant Redis as Redis Queue
    participant Consumer as Consumer Service
    participant Mongo as MongoDB

    Frontend->>Django: 1. Call Push API
    Django->>Redis: 2. Push to Redis List
    Consumer->>Redis: 3. Pop from Redis List
    Consumer->>Mongo: 4. Update Increment in Document
    Frontend->>Django: 5. Call Count API
    Django->>Mongo: 6. Query Count from Document
    Mongo-->>Django: Return Count
    Django-->>Frontend: Return Count

    Note over Frontend,Mongo: Asynchronous Visit Count Processing
    Note over Redis,Consumer: Using Consumer YAML Configuration
                                      </pre>
                                    </div>
                                  ` : ''}
                                </div>
                              `).join('')}
                            </div>
                          `).join('')}
                        </div>
                      ` : ''}
                    </div>
                  `).join('')}
                </div>
              </div>

              <div class="resume-section">
                <h2 class="section-title">Education</h2>
                <div class="content">
                  ${educationItems.map((item) => `
                    <div class="education-item">
                      <div class="education-header">
                        <h3>${item.institution}</h3>
                        <span class="education-period">${item.period}</span>
                      </div>
                      <ul>
                        ${item.programs.map((program) => `<li>${program}</li>`).join('')}
                      </ul>
                    </div>
                  `).join('')}
                </div>
              </div>
            </body>
            </html>
          `;

          printWindow.document.write(pdfContent);
          printWindow.document.close();

          // Add Mermaid script after the content is written
          const mermaidScript = document.createElement('script');
          mermaidScript.type = 'module';
          mermaidScript.textContent = `
            import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ 
              startOnLoad: true,
              theme: 'default',
              flowchart: {
                useMaxWidth: false,
                htmlLabels: true
              },
              classDiagram: {
                useMaxWidth: false,
                htmlLabels: true
              },
              sequence: {
                useMaxWidth: false,
                htmlLabels: true
              }
            });
            
            // Wait for all Mermaid diagrams to render
            mermaid.run().then(() => {
              // Trigger print after diagrams are rendered
              window.print();
              setTimeout(() => {
                window.close();
              }, 1000);
            });
          `;
          printWindow.document.head.appendChild(mermaidScript);

          btn.textContent = 'Export PDF Resume';
          btn.disabled = false;

        } catch (error) {
          console.error('Error generating PDF:', error);
          const btn = document.getElementById('export-pdf-btn');
          if (btn) {
            btn.textContent = 'Export PDF Resume';
            btn.disabled = false;
          }
        }
      });
    </script>

    <style>
      .pdf-export-section {
        display: flex;
        justify-content: center;
        margin: 3rem 0;
        padding: 2rem;
      }

      .export-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .export-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      .export-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
      }

      /* PDF-specific styles */
      @media print {
        .export-btn {
          display: none !important;
        }
        
        .about {
          background: white !important;
          color: #333 !important;
          box-shadow: none !important;
        }
      }
    </style>
  </BaseLayout>

</body>
</rewritten_file>