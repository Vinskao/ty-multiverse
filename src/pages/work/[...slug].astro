---
import { type CollectionEntry, getCollection } from 'astro:content';

import BaseLayout from '../../layouts/BaseLayout.astro';

import ContactCTA from '../../components/ContactCTA.astro';
import Hero from '../../components/Hero.astro';
import { Icon } from '../../components/Icon';
import Pill from '../../components/Pill.astro';

interface Props {
	entry: CollectionEntry<'work'>;
}

// This is a dynamic route that generates a page for every Markdown file in src/content/
// Read more about dynamic routes and this `getStaticPaths` function in the Astro docs:
// https://docs.astro.build/en/core-concepts/routing/#dynamic-routes
export async function getStaticPaths() {
	const work = await getCollection('work');
	return work.map((entry) => ({
		params: { slug: entry.slug },
		props: { entry },
	}));
}

export const prerender = true;


const { entry } = Astro.props;
const { Content } = await entry.render();

const imageLinks = [
    {
        imgUrl: "/tymultiverse/assets/stock-3.jpg",
        linkUrl: "https://www.freecodecamp.org/certification/TianyiKao/javascript-algorithms-and-data-structures"
    },
    {
        imgUrl: "/tymultiverse/assets/stock-1.jpg",
        linkUrl: "https://www.freecodecamp.org/certification/TianyiKao/data-visualization"
    },
	{
        imgUrl: "/tymultiverse/assets/java.jpg",
        linkUrl: ""
    },
    {
        imgUrl: "/tymultiverse/assets/stock-4.jpg",
        linkUrl: "https://www.cloudskillsboost.google/public_profiles/28b434be-64c8-4b98-b2a6-7851772bda44/badges/3572551?utm_medium=social&utm_source=linkedin&utm_campaign=ql-social-share"
    },
	{
        imgUrl: "/tymultiverse/assets/mongodb-logo.jpg",
        linkUrl: ""
    },
	{
        imgUrl: "/tymultiverse/assets/SQL.jpg",
        linkUrl: ""
    },
	{
        imgUrl: "/tymultiverse/assets/container.jpg",
        linkUrl: ""
    },
];

const currentPageIndex = imageLinks.findIndex((imageLink) => imageLink.imgUrl === entry.data.img);



---

<BaseLayout title={entry.data.title} description={entry.data.description}>
	<div class="stack gap-20">
		<div class="stack gap-15">
			<header>
				<div class="wrapper stack gap-2">
					<a class="back-link" href="/tymultiverse/work/"><Icon icon="arrow-left" /> Work</a>
					<Hero title={entry.data.title} align="start">
						<div class="details">
							<div class="tags">
								{entry.data.tags.map((t) => <Pill>{t}</Pill>)}
							</div>
							<div class="content-info">
								<div class="publish-info">
									<time datetime={entry.data.publishDate.toISOString()}>
										{entry.data.publishDate.toLocaleDateString('zh-TW', {
											year: 'numeric',
											month: 'long',
											day: 'numeric'
										})}
									</time>
								</div>
								<p class="description">{entry.data.description}</p>
							</div>
						</div>
					</Hero>
				</div>
			</header>
			<main class="wrapper">
				<div class="stack gap-10 content">
						{currentPageIndex !== -1 && (
						<a href={imageLinks[currentPageIndex].linkUrl}>
							<img src={entry.data.img} alt={`Image ${currentPageIndex + 1}`} />
						</a>
						)}		
					<div class="content">
						<Content />
					</div>
				</div>
			</main>
		</div>
		<ContactCTA />

	</div>
</BaseLayout>


<style>
	header {
		padding-bottom: 2.5rem;
		border-bottom: 1px solid var(--gray-800);
	}

	.back-link {
		display: none;
	}

	.details {
		display: flex;
		flex-direction: column;
		padding: 0.5rem;
		gap: 1rem;
		justify-content: flex-start;
		align-items: flex-start;
	}

	.tags {
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
		align-items: center;
		gap: 0.5rem;
		margin-bottom: 0.5rem;
	}

	.content-info {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
		width: 100%;
	}

	.publish-info {
		font-size: var(--text-sm);
		color: var(--gray-400);
		font-weight: 500;
		line-height: 1.2;
		margin: 0;
		display: inline;
		word-break: break-word;
		overflow-wrap: break-word;
	}

	.publish-info time {
		color: var(--accent-regular);
		font-weight: 600;
	}

	.description {
		font-size: var(--text-lg);
		line-height: 1.6;
		margin: 0;
		margin-top: 0.25rem;
		color: var(--gray-200);
		font-weight: 400;
		word-break: break-word;
		overflow-wrap: break-word;
		hyphens: auto;
	}

	.content {
		width: 100%;            /* Responsive, takes full width of container */
		max-width: 83rem;       /* Match wrapper max-width for consistent width */
		margin: 0 auto;         /* Centers the content horizontally */
		line-height: 1.7;
		font-size: var(--text-md);
		color: var(--gray-200);
		padding: 0 1rem;        /* Adds horizontal padding like the image */
		box-sizing: border-box; /* Ensures padding is included in width calculation */
		/* 防止內容在極端放大時超出容器 */
		overflow-wrap: anywhere;
		word-break: break-word;
		min-width: 0;
		hyphens: auto;
		overflow: hidden; /* 防止內容超出容器 */
	}

	.content > :global(* + *) {
		margin-top: 1.5rem;
	}

	.content :global(h1) {
		font-size: var(--text-4xl);
		font-weight: 700;
		color: var(--gray-0);
		margin: 3rem 0 2rem 0;
		padding-bottom: 1rem;
		border-bottom: 3px solid var(--accent-regular);
		background: linear-gradient(135deg, var(--accent-regular), var(--accent-dark));
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

	.content :global(h2) {
		font-size: var(--text-3xl);
		font-weight: 600;
		color: var(--gray-100);
		margin: 2.5rem 0 1.5rem 0;
		padding-left: 1rem;
		border-left: 4px solid var(--accent-light);
		background: linear-gradient(90deg, var(--accent-light), transparent);
		padding: 0.5rem 1rem;
		border-radius: 0 0.5rem 0.5rem 0;
	}

	.content :global(h3) {
		font-size: var(--text-2xl);
		font-weight: 600;
		color: var(--gray-200);
		margin: 2rem 0 1rem 0;
		padding-bottom: 0.5rem;
		border-bottom: 2px solid var(--gray-800);
	}

	.content :global(h4) {
		font-size: var(--text-xl);
		font-weight: 500;
		color: var(--gray-300);
		margin: 1.5rem 0 0.75rem 0;
	}

	.content :global(h5) {
		font-size: var(--text-lg);
		font-weight: 500;
		color: var(--gray-400);
		margin: 1.25rem 0 0.5rem 0;
	}

	.content :global(h6) {
		font-size: var(--text-md);
		font-weight: 500;
		color: var(--gray-500);
		margin: 1rem 0 0.5rem 0;
	}

	.content :global(img) {
		position: relative;
		border-radius: 1.5rem;
		box-shadow: var(--shadow-md);
		background: var(--gradient-subtle);
		border: 2px solid var(--gray-800);
		transition: all 0.4s ease;
		max-width: 100%;
		height: auto;
		margin: 2rem auto;
		display: block;
		object-fit: contain;
	}

	.content :global(img):hover {
		transform: scale(1.05);
		box-shadow: var(--shadow-lg);
		border-color: var(--accent-light);
	}

	.content :global(hr) {
		border: none;
		height: 2px;
		background: linear-gradient(90deg, transparent, var(--accent-regular), transparent);
		margin: 3rem 0;
		border-radius: 1px;
	}

	.content :global(strong) {
		color: var(--gray-100);
		font-weight: 600;
	}

	.content :global(em) {
		color: var(--accent-light);
		font-style: italic;
		font-weight: 500;
	}

	
	.content :global(p) {
		margin: 1.25rem 0;
		line-height: 1.8;
		text-align: justify;
	}

	.content :global(ul),
	.content :global(ol) {
		margin: 1.5rem 0;
		padding-left: 2rem;
		word-break: break-word;
		overflow-wrap: anywhere;
	}

	.content :global(li) {
		margin: 0.75rem 0;
		line-height: 1.6;
	}

	.content :global(blockquote) {
		font-size: var(--text-lg);
		font-family: var(--font-brand);
		font-weight: 600;
		line-height: 1.6;
		padding: 1.5rem 2rem;
		margin: 2rem 0;
		border-left: 4px solid var(--accent-regular);
		background: linear-gradient(135deg, var(--gray-900), var(--gray-800));
		border-radius: 0 1rem 1rem 0;
		color: var(--gray-100);
		box-shadow: var(--shadow-sm);
		position: relative;
	}

	.content :global(blockquote)::before {
		content: '"';
		font-size: 3rem;
		color: var(--accent-light);
		position: absolute;
		top: -0.5rem;
		left: 1rem;
		font-family: serif;
	}

	.content :global(code) {
		background: var(--gray-800);
		color: var(--accent-dark);
		padding: 0.2rem 0.4rem;
		border-radius: 0.25rem;
		font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
		font-size: 0.9em;
		border: 1px solid var(--gray-700);
		white-space: normal;
		word-break: break-word;
		overflow-wrap: anywhere;
	}

	.content :global(pre) {
		background: linear-gradient(135deg, var(--gray-900), var(--gray-800));
		border: 1px solid var(--gray-700);
		border-radius: 0.75rem;
		padding: 2.5rem 1.5rem 1.5rem 1.5rem; /* 增加頂部空間，避免工具欄遮擋程式碼 */
		margin: 2rem 0;
		overflow-x: auto;
		max-width: 100%;
		white-space: pre; /* 預設保留縮排與不換行 */
		box-shadow: var(--shadow-md);
		position: relative;
		font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'SFMono-Regular', 'Consolas', monospace;
		font-size: 0.875em;
		line-height: 1.5;
	}

	/* 讓 pre 內所有節點都繼承 white-space，避免被全域規則覆蓋而吃掉前導空格 */
	.content :global(pre * ) {
		white-space: inherit !important;
		font-family: inherit;
		tab-size: inherit;
		-moz-tab-size: inherit;
		-o-tab-size: inherit;
	}

	/* 語言徽章 */
	.content :global(pre[data-lang]::before) {
		content: attr(data-lang);
		position: absolute;
		top: 0.5rem;
		left: 0.75rem;
		padding: 0.1rem 0.5rem;
		font-size: 0.75rem;
		letter-spacing: 0.03em;
		background: var(--gray-800);
		border: 1px solid var(--gray-700);
		border-radius: 0.5rem;
		color: var(--gray-300);
		text-transform: uppercase;
		pointer-events: none;
	}

	/* 代碼區工具列（複製） */
	.content :global(pre .code-actions) {
		position: absolute;
		top: 0.75rem; /* 向下移動一點，避免與語言徽章重疊 */
		right: 0.75rem;
		display: flex;
		gap: 0.25rem; /* 減少按鈕間距 */
		flex-wrap: wrap; /* 允許換行 */
		max-width: calc(100% - 1.5rem); /* 限制最大寬度 */
	}

	.content :global(pre .code-actions .code-btn) {
		appearance: none;
		border: 1px solid var(--gray-700);
		background: var(--gray-800);
		color: var(--gray-200);
		font-size: 0.7rem; /* 稍微減小字體 */
		line-height: 1;
		padding: 0.25rem 0.4rem; /* 減少內邊距 */
		border-radius: 0.3rem;
		cursor: pointer;
		transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
		font-family: inherit; /* 保持一致的字體 */
		min-width: auto; /* 不設定最小寬度 */
	}

	.content :global(pre .code-actions .code-btn:hover) {
		background: var(--gray-750, #2b2b2b);
		border-color: var(--gray-600);
		color: var(--gray-100);
	}

	/* 複製完成提示效果 */
	.content :global(pre.copy-done) {
		box-shadow: 0 0 0 2px var(--accent-light) inset, var(--shadow-md);
	}




	.content :global(pre code) {
		background: none;
		border: none;
		padding: 0;
		color: var(--gray-200);
		font-family: inherit; /* 繼承 pre 的等寬字體 */
		font-size: inherit;   /* 繼承 pre 的字體大小 */
		line-height: inherit; /* 繼承行高 */
		white-space: inherit; /* 關鍵：與 pre 保持一致，保留前導空格 */
		display: block; /* 確保代碼區塊正確顯示 */
		tab-size: 4; /* 設定 Tab 寬度為 4 個空格 */
		-moz-tab-size: 4;
		-o-tab-size: 4;
	}

	.content :global(table) {
		width: 100%;
		border-collapse: collapse;
		margin: 2rem 0;
		background: var(--gray-900);
		border-radius: 0.75rem;
		overflow: hidden;
		box-shadow: var(--shadow-sm);
		table-layout: fixed;
	}

	.content :global(th) {
		background: var(--accent-regular);
		color: var(--gray-999);
		padding: 1rem;
		text-align: left;
		font-weight: 600;
		border-bottom: 2px solid var(--accent-dark);
		word-break: break-word;
		overflow-wrap: anywhere;
	}

	.content :global(td) {
		padding: 1rem;
		border-bottom: 1px solid var(--gray-800);
		color: var(--gray-200);
		word-break: break-word;
		overflow-wrap: anywhere;
	}

	.content :global(tr:hover) {
		background: var(--gray-800);
	}

	.back-link,
	.content :global(a) {
		text-decoration: 1px solid underline transparent;
		text-underline-offset: 0.25em;
		transition: text-decoration-color var(--theme-transition);
		color: var(--accent-regular);
		font-weight: 500;
		word-break: break-all;
		overflow-wrap: anywhere;
	}

	/* 全域覆蓋規則 - 確保文章內容不會破版 */
	.content :global(*) {
		box-sizing: border-box;
		min-width: 0; /* 防止 flex 子項不縮小 */
		max-width: 100%; /* 防止內容超出容器 */
		word-break: break-word;
		overflow-wrap: anywhere;
		white-space: normal;
	}

	.content :global(img) {
		max-width: 100% !important;
		height: auto !important;
		object-fit: contain;
		display: block;
		margin: 2rem auto;
		border-radius: 1.5rem;
	}

	.content :global(table) {
		width: 100% !important;
		table-layout: fixed !important;
		word-break: break-word !important;
		overflow-wrap: anywhere !important;
	}

	/* 表格內部也全面限制寬度與換行，避免撐破容器 */
	.content :global(table thead),
	.content :global(table tbody),
	.content :global(table tr),
	.content :global(table th),
	.content :global(table td) {
		max-width: 100%;
		word-break: break-word;
		overflow-wrap: anywhere;
		white-space: normal;
	}

	/* 內嵌媒體與外嵌內容防溢出 */
	.content :global(iframe),
	.content :global(embed),
	.content :global(video),
	.content :global(svg) {
		max-width: 100%;
		width: 100%;
		height: auto;
		display: block;
	}

	.back-link:hover,
	.back-link:focus,
	.content :global(a:hover),
	.content :global(a:focus) {
		text-decoration-color: currentColor;
		color: var(--accent-light);
	}

	@media (min-width: 50em) {
		.back-link {
			display: block;
			align-self: flex-start;
		}

		.details {
			flex-direction: column;
			gap: 2rem;
			align-items: flex-start;
		}

		.content-info {
			flex: 1;
		}

		.content {
			font-size: var(--text-lg);
			line-height: 1.8;
		}

		.content :global(h1) {
			font-size: var(--text-5xl);
			margin: 4rem 0 2.5rem 0;
		}

		.content :global(h2) {
			font-size: var(--text-4xl);
			margin: 3rem 0 2rem 0;
		}

		.content :global(h3) {
			font-size: var(--text-3xl);
			margin: 2.5rem 0 1.5rem 0;
		}

		.content :global(blockquote) {
			font-size: var(--text-2xl);
			padding: 2rem 2.5rem;
			margin: 2.5rem 0;
		}

		.content :global(pre) {
			padding: 2rem;
			margin: 2.5rem 0;
		}

		.content :global(table) {
			margin: 2.5rem 0;
		}
	}

	/* 超寬螢幕 - 最佳閱讀體驗 */
	@media (min-width: 1440px) {
		.content {
			font-size: var(--text-lg);
			line-height: 1.8;
			max-width: min(83rem, 95vw); /* 限制為視窗寬度 95% 內 */
			margin: 0 auto;
			padding: 0 2rem;        /* 收斂左右留白，強化代碼區可視範圍 */
		}

		.content :global(h1) {
			font-size: var(--text-6xl);
			margin: 6rem 0 4rem 0;
		}

		.content :global(h2) {
			font-size: var(--text-5xl);
			margin: 5rem 0 3rem 0;
		}

		.content :global(h3) {
			font-size: var(--text-4xl);
			margin: 4rem 0 2.5rem 0;
		}

		.content :global(pre) {
			padding: 3rem;
			font-size: 1em;
		}

		.content :global(blockquote) {
			font-size: var(--text-2xl);
			padding: 3rem 4rem;
		}

		/* 超寬螢幕：維持單欄佈局避免放大時破版 */
		.content {
			column-count: 1;
			column-gap: 0;
			column-rule: none;
		}

		/* 防止標題跨欄 */
		.content :global(h1),
		.content :global(h2),
		.content :global(h3),
		.content :global(h4),
		.content :global(h5) {
			break-before: column;
			break-after: avoid;
		}

		/* 程式碼區塊不分欄 */
		.content :global(pre) {
			break-inside: avoid;
			column-span: all;
		}

		/* 表格不分欄 */
		.content :global(table) {
			break-inside: avoid;
			column-span: all;
		}

		/* 圖片不分欄 */
		.content :global(img) {
			break-inside: avoid;
			column-span: all;
		}
	}

	/* 平板電腦 - 大尺寸 */
	@media (min-width: 1024px) and (max-width: 1439px) {
		.content {
			font-size: var(--text-lg);
			line-height: 1.8;
			max-width: min(83rem, 95vw);
			padding: 0 2rem;        /* More padding on larger screens */
		}

		.content :global(h1) {
			font-size: var(--text-5xl);
			margin: 5rem 0 3rem 0;
		}

		.content :global(h2) {
			font-size: var(--text-4xl);
			margin: 4rem 0 2.5rem 0;
		}

		.content :global(h3) {
			font-size: var(--text-3xl);
			margin: 3rem 0 2rem 0;
		}

		.content :global(pre) {
			padding: 2.5rem;
			font-size: 0.95em;
		}

		.content :global(blockquote) {
			font-size: var(--text-xl);
			padding: 2.5rem 3rem;
		}
	}

	/* 平板電腦 - 中等尺寸 */
	@media (min-width: 768px) and (max-width: 1023px) {
		.content {
			font-size: var(--text-md);
			line-height: 1.7;
			max-width: min(83rem, 98vw);
			padding: 0 1.5rem;        /* Balanced padding for medium tablets */
		}

		.content :global(h1) {
			font-size: var(--text-4xl);
			margin: 3.5rem 0 2.5rem 0;
		}

		.content :global(h2) {
			font-size: var(--text-3xl);
			margin: 3rem 0 2rem 0;
		}

		.content :global(h3) {
			font-size: var(--text-2xl);
			margin: 2.5rem 0 1.5rem 0;
		}

		.content :global(pre) {
			padding: 1.5rem;
			font-size: 0.9em;
		}

		.content :global(blockquote) {
			font-size: var(--text-lg);
			padding: 2rem 2.5rem;
		}
	}

	/* 平板電腦 - 小尺寸 */
	@media (min-width: 640px) and (max-width: 767px) {
		.content {
			font-size: var(--text-base);
			line-height: 1.6;
			max-width: 98vw;
			padding: 0 1rem;        /* Reduced padding for smaller tablets */
		}

		.content :global(h1) {
			font-size: var(--text-3xl);
			margin: 3rem 0 2rem 0;
		}

		.content :global(h2) {
			font-size: var(--text-2xl);
			margin: 2.5rem 0 1.5rem 0;
		}

		.content :global(h3) {
			font-size: var(--text-xl);
			margin: 2rem 0 1.25rem 0;
		}

		.content :global(pre) {
			padding: 1.25rem;
			font-size: 0.85em;
		}

		.content :global(blockquote) {
			font-size: var(--text-md);
			padding: 1.5rem 2rem;
		}
	}

	/* 大型手機 */
	@media (min-width: 480px) and (max-width: 639px) {
		.content {
			font-size: var(--text-base);
			line-height: 1.6;
			max-width: 98vw;
			padding: 0 1rem;        /* Standard padding for large phones */
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(h1) {
			font-size: var(--text-2xl);
			margin: 2.5rem 0 1.5rem 0;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(h2) {
			font-size: var(--text-xl);
			margin: 2rem 0 1.25rem 0;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(h3) {
			font-size: var(--text-lg);
			margin: 1.75rem 0 1rem 0;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(p) {
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(pre) {
			padding: 1rem;
			font-size: 0.8em;
			white-space: pre-wrap;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(code) {
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(blockquote) {
			font-size: var(--text-sm);
			padding: 1.25rem 1.5rem;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(table) {
			display: block;
			overflow-x: auto;
			-webkit-overflow-scrolling: touch;
		}
	}

	/* 小型手機 */
	@media (max-width: 479px) {
		.content {
			font-size: var(--text-sm);
			line-height: 1.6;
			max-width: 98vw;
			padding: 0 0.75rem;        /* Slightly reduced padding for small phones */
			word-wrap: break-word;
			overflow-wrap: break-word;
			hyphens: auto;
		}

		.content :global(h1) {
			font-size: var(--text-xl);
			margin: 2rem 0 1.25rem 0;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(h2) {
			font-size: var(--text-lg);
			margin: 1.75rem 0 1rem 0;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(h3) {
			font-size: var(--text-md);
			margin: 1.5rem 0 0.75rem 0;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(p) {
			margin: 1rem 0;
			word-wrap: break-word;
			overflow-wrap: break-word;
			hyphens: auto;
		}

		.content :global(pre) {
			padding: 0.75rem;
			font-size: 0.75em;
			margin: 1rem 0;
			overflow-x: auto;
			white-space: pre-wrap;
			word-wrap: break-word;
			overflow-wrap: break-word;
			-webkit-overflow-scrolling: touch;
		}

		.content :global(code) {
			word-wrap: break-word;
			overflow-wrap: break-word;
			white-space: pre-wrap;
		}

		.content :global(blockquote) {
			font-size: var(--text-sm);
			padding: 1rem 1.25rem;
			margin: 1.25rem 0;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(ul),
		.content :global(ol) {
			padding-left: 1.25rem;
			margin: 1rem 0;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(li) {
			margin: 0.5rem 0;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(table) {
			display: block;
			overflow-x: auto;
			margin: 1rem 0;
			font-size: 0.75em;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(th),
		.content :global(td) {
			padding: 0.25rem 0.5rem;
			white-space: normal;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(img) {
			max-width: 100%;
			height: auto;
			border-radius: 0.25rem;
		}

		.content :global(a) {
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(strong),
		.content :global(em) {
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(th),
		.content :global(td) {
			padding: 0.5rem 0.25rem;
		}

		/* 小屏優化：隱藏複雜的圖表或過大的圖片 */
		.content :global(img) {
			max-width: 100%;
			height: auto;
			border-radius: 0.5rem;
		}

		/* 確保列表項目不會太擠 */
		.content :global(ul),
		.content :global(ol) {
			padding-left: 1.25rem;
		}

		.content :global(li) {
			margin: 0.5rem 0;
			line-height: 1.5;
		}

		/* 程式碼區塊在小螢幕上的處理 */
		.content :global(pre) {
			white-space: pre-wrap;
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		/* 確保表格在小螢幕上可滾動 */
		.content :global(table) {
			display: block;
			overflow-x: auto;
			word-wrap: break-word;
			overflow-wrap: break-word;
			max-width: 100%;
			box-sizing: border-box;
		}

		/* 優化連結在觸控設備上的點擊區域 */
		.content :global(a) {
			min-height: 44px;
			display: inline-block;
			padding: 0.25rem 0;
		}

		/* 通用文字換行保護 */
		.content :global(p),
		.content :global(span),
		.content :global(div) {
			word-wrap: break-word;
			overflow-wrap: break-word;
		}

		.content :global(code):not(pre code) {
			word-wrap: break-word;
			overflow-wrap: break-word;
			white-space: pre-wrap;
		}
	}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
	const pres = document.querySelectorAll('.content pre');
	pres.forEach(pre => {
		// 推斷語言：從子 code 的 class，例如 language-java / lang-java
		const codeEl = pre.querySelector('code');
		if (codeEl) {
			const cls = (codeEl as HTMLElement).className || '';
			const langMatch = cls.match(/(?:language|lang)-([a-z0-9+#]+)/i);
			if (langMatch) {
				let lang = langMatch[1];
				// 語言名稱映射，顯示更友好的名稱
				const langMap: Record<string, string> = {
					'js': 'JavaScript',
					'ts': 'TypeScript',
					'jsx': 'React',
					'tsx': 'React+TS',
					'py': 'Python',
					'java': 'Java',
					'cpp': 'C++',
					'c': 'C',
					'cs': 'C#',
					'php': 'PHP',
					'ruby': 'Ruby',
					'go': 'Go',
					'rust': 'Rust',
					'sql': 'SQL',
					'html': 'HTML',
					'css': 'CSS',
					'scss': 'SCSS',
					'less': 'Less',
					'json': 'JSON',
					'xml': 'XML',
					'yaml': 'YAML',
					'yml': 'YAML',
					'sh': 'Shell',
					'bash': 'Bash',
					'powershell': 'PowerShell'
				};
				lang = langMap[lang] || lang;
				pre.setAttribute('data-lang', lang);
			}
		}

		// 建立工具列
		const actions = document.createElement('div');
		actions.className = 'code-actions';

		const copyBtn = document.createElement('button');
		copyBtn.className = 'code-btn';
		copyBtn.type = 'button';
		copyBtn.textContent = 'Copy';

		actions.appendChild(copyBtn);
		pre.appendChild(actions);

		copyBtn.addEventListener('click', async () => {
			let text = '';
			if (codeEl) {
				// 保留原始的縮排和換行
				text = codeEl.textContent || '';
			} else {
				// 如果沒有 code 標籤，直接從 pre 獲取
				text = pre.textContent || '';
			}

			// 移除前後空白，但保留內部縮排
			text = text.trim();

			try {
				await navigator.clipboard.writeText(text);
				pre.classList.add('copy-done');
				copyBtn.textContent = 'Copied';
				setTimeout(() => { pre.classList.remove('copy-done'); copyBtn.textContent = 'Copy'; }, 1200);
			} catch (err) {
				console.warn('複製失敗:', err);
			}
		});

	});
});
</script>
